<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--suppress SqlNoDataSourceInspection, SqlDialectInspection -->
<mapper namespace="org.clever.security.mapper.QueryMapper">

    <select id="allSysName" resultType="string">
        select distinct sys_name from user_sys
    </select>

    <select id="allRoleName" resultType="string">
        select distinct name from role
    </select>

    <select id="findRoleNameByUser" resultType="string">
        select
            b.name
        from user_role a left join role b on (a.role_name=b.name)
        where a.username=#{username}
    </select>

    <select id="findPermissionStrByRole" resultType="string">
        select permission_str from role_permission where role_name=#{roleName} order by permission_str asc
    </select>

    <select id="findRememberMeToken" resultType="org.clever.security.entity.model.UserRememberMeToken">
        select
            a.*,
            b.id as user_id,
            b.user_type,
            b.telephone,
            b.email,
            b.expired_time,
            b.locked,
            b.enabled,
            b.description
        from remember_me_token a
            left join user b on (a.username = b.username)
        where a.username = ''
            and a.sys_name = ''
            and a.last_used >= ''
            <![CDATA[ and a.last_used <= '' ]]>
            and b.telephone = ''
            and b.email = ''
        order by a.update_at DESC, a.last_used DESC
    </select>
</mapper>